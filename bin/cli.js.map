{"version":3,"file":"cli.js","sources":["../cli/call-command.ts","../cli/copy-extrance.ts","../cli/ensure-dir.ts","../cli/find-command.ts","../cli/source-dest-files.ts","../cli/start.ts","../cli/console-hello.ts","../cli/index.ts","../cli/parse-args.ts","../cli/showhelp.ts"],"sourcesContent":["import { spawn } from \"child_process\";\nimport process from \"process\";\n/**\n *\n * @param {string} command\n * @param { string[]} commandargs\n */\n\nfunction 执行命令(\n    /* commandstring,  */ command: string,\n    commandargs: string[]\n) {\n    // console.log(commandstring);\n    console.log(\"\\n\");\n    console.log([command, ...commandargs]);\n    const runobj = spawn(command, commandargs, {\n        stdio: [\"pipe\", \"pipe\", \"pipe\"],\n        shell: true,\n    });\n    runobj.stdout.on(\"data\", (data) => {\n        console.log(\n            ` ${data}`\n                .split(\"\\n\")\n                .filter((t) => t !== \"\")\n                .join(\"\\n\\n\")\n        );\n        console.log(\"\\n\");\n    });\n    runobj.stderr.on(\"data\", (data) => {\n        console.error(\n            ` ${data}`\n                .split(\"\\n\")\n                .filter((t) => t !== \"\")\n                .join(\"\\n\\n\")\n        );\n        console.log(\"\\n\");\n    });\n    runobj.on(\"close\", (code) => {\n        console.log(`child process exited with code ${code}`);\n        process.exit(code || 0);\n    });\n}\nexport default 执行命令;\n","import fs from \"fs\";\nimport path from \"path\";\nimport process from \"process\";\nimport 判断并创建目录 from \"./ensure-dir\";\nconst pwddir = process.cwd();\n/**\n * @param {(import(\"fs\").PathLike)[]} sourcefiles\n * @param {string[]} destfiles\n */\nexport default function 生成入口文件(\n    sourcefiles: string[],\n    destfiles: string[]\n) {\n    /**\n     * @param {import(\"fs\").PathLike} p\n     * @param {number} i\n     *\n     */\n    destfiles.forEach((p, i) => {\n        if (!fs.existsSync(p)) {\n            console.log(`inputfile  not exsited! ${p}\\n`);\n            console.log(`initialize inputfile from ${sourcefiles[i]}\\n`);\n            [\"public\", \"src\"]\n                .map((t) => path.resolve(pwddir, t))\n                .forEach((e) => 判断并创建目录(e));\n            fs.copyFileSync(sourcefiles[i], p);\n        }\n    });\n}\n","/**\n * @param {import(\"fs\").PathLike} p\n */\nexport default function 判断并创建目录(p: fs.PathLike) {\n    if (!fs.existsSync(p)) {\n        console.log(\"所需的目录不存在,创建目录\", p);\n        console.log(\"\\n\");\n        fs.mkdirSync(p);\n    }\n}\nimport fs from \"fs\";\n","/**\n * @param {string} t\n */\nexport function commandfind(t: string) {\n    return path.join(\n        __dirname,\n        \"../\",\n        \"node_modules\",\n        \".bin\",\n        t.trim() + (process.platform === \"win32\" ? \".cmd\" : \"\")\n    );\n}\nimport path from \"path\";\nimport process from \"process\";\n","import path from \"path\";\nimport process from \"process\";\n// const fs = require(\"fs\");\nconst pwddir = process.cwd();\n\nconst inputfiles = [\"public/index.html\", \"src/index.js\"];\nconst sourcefiles = inputfiles.map((p) =>\n    path.resolve(__dirname, \"../\", \"release\", p)\n);\nconst destfiles = inputfiles.map((p) => path.resolve(pwddir, p));\n\nexport { sourcefiles, destfiles };\n","import fs from \"fs\";\nimport path from \"path\";\nimport process from \"process\";\nimport 执行命令 from \"./call-command\";\nimport 生成入口文件 from \"./copy-extrance\";\nimport { commandfind } from \"./find-command\";\nimport { showhelp } from \"./showhelp\";\nimport { destfiles, sourcefiles } from \"./source-dest-files\";\nconst webpackcmd = \"webpack\";\nexport function start(\n    operation: string | undefined,\n    参数object: Record<string, string>\n) {\n    const 解析参数config = 参数object[\"config\"];\n    const defaultwebpackconfig = require.resolve(\n        path.resolve(__dirname, \"../\", \"./release/config/webpack.config.js\")\n    );\n    const 参数webpackconfigfile = 解析参数config\n        ? path.resolve(解析参数config)\n        : defaultwebpackconfig;\n    Reflect.set(参数object, \"config\", 参数webpackconfigfile);\n    const mode = 参数object[\"mode\"];\n    if (\"start\" === operation || \"development\" === mode) {\n        let command: string, commandargs: string[];\n        process.env.NODE_ENV = \"development\";\n        Reflect.set(参数object, \"mode\", process.env.NODE_ENV);\n\n        生成入口文件(sourcefiles, destfiles);\n        command = commandfind(webpackcmd);\n        commandargs = [\"serve\"];\n        changecmdnpx(command, commandargs, (cmd: string) => {\n            command = cmd;\n        });\n        addparamstocmdargs(参数object, commandargs);\n        console.log(\"\\n\");\n        console.log(`开发模式 启动 webpack-dev-server`);\n        console.log(\"\\n\");\n        执行命令(command, commandargs);\n    } else if (\"build\" === operation || \"production\" === mode) {\n        let command: string, commandargs: string[];\n        console.log(\"\\n\");\n        console.log(`生产模式 启动 webpack`);\n        console.log(\"\\n\");\n        process.env.NODE_ENV = \"production\";\n        Reflect.set(参数object, \"mode\", process.env.NODE_ENV);\n        生成入口文件(sourcefiles, destfiles);\n        command = commandfind(webpackcmd);\n        commandargs = [\"build\"];\n        changecmdnpx(command, commandargs, (cmd: string) => {\n            command = cmd;\n        });\n\n        addparamstocmdargs(参数object, commandargs);\n        执行命令(command, commandargs);\n    } else {\n        showhelp();\n    }\n}\n\nfunction addparamstocmdargs(参数object: object, commandargs: string[]) {\n    Object.entries(参数object).forEach(([key, value]) => {\n        commandargs.push(`--${key}=${value}`);\n    });\n}\n\nfunction changecmdnpx(\n    command: fs.PathLike,\n    commandargs: string[],\n    setcmd: { (cmd: string): void }\n) {\n    if (!fs.existsSync(command)) {\n        commandargs.unshift(webpackcmd);\n        setcmd(\"npx\" + (process.platform === \"win32\" ? \".cmd\" : \"\"));\n    }\n}\n","export function consolehello() {\n    console.log(\"\\n\");\n    console.log(\"webpack-react-vue-spa-awesome-config\");\n    console.log(\"\\n\");\n    console.log(\n        `极速、零配置的 web 应用打包工具, 同时支持 react 和 vue 的单页面应用,提供开箱即用支持,基于webpack `\n    );\n    console.log(\"\\n\");\n    console.log(\n        \"Fast, zero-configuration web application packaging tool that supports both single-page applications for react and vue, out-of-the-box support\"\n    );\n    console.log(\"\\n\");\n    console.log(`\\nworking directory : ${process.cwd()}\\n`);\n    console.log(`\\ncommand filename : ${__filename}\\n`);\n}\nimport process from \"process\";\n","// #!/usr/bin/env node\n\"use strict\";\nimport process from \"process\";\nimport { consolehello } from \"./console-hello\";\n// import 判断并创建目录 from \"./ensure-dir\";\nimport { parseargs } from \"./parse-args\";\nimport { start } from \"./start\";\n\nconsolehello();\n// console.log(\"输入的参数:\");\n// console.log(JSON.stringify(process.argv, null, 4));\nconst inargs = process.argv.slice(2);\nconsole.log(\"接收的参数\", inargs);\nconst operation = inargs.includes(\"start\")\n    ? \"start\"\n    : inargs.includes(\"build\")\n    ? \"build\"\n    : undefined;\nconst 参数object = parseargs(inargs);\nconsole.log(\"解析的参数:\");\nconsole.log(JSON.stringify(参数object, null, 4));\n\nstart(operation, 参数object);\n","/**\n * @param {string[]} args\n * @returns{Record<string,string>}\n */\nfunction parseargs(args: string[]): Record<string, string> {\n    /**@type{Record<string,string>} */\n    const 参数obj: Record<string, string> = {};\n    args.filter((s) => s.startsWith(\"--\"))\n        .map((s) => /--(?<key>.+?)=(?<value>.+)/g.exec(s))\n        .forEach((execArray) => {\n            var _a, _b, _c;\n            const groups =\n                (_a = execArray) === null || _a === void 0 ? void 0 : _a.groups;\n            const key =\n                (_b = groups) === null || _b === void 0 ? void 0 : _b.key;\n            const value =\n                (_c = groups) === null || _c === void 0 ? void 0 : _c.value;\n            if (key && value) {\n                参数obj[key] = value;\n            }\n        });\n    return 参数obj;\n}\nexport { parseargs };\n","import process from \"process\";\n\nexport function showhelp() {\n    console.log(\"\\n\");\n    console.log(\"usage:\");\n    console.log(\"\\n\");\n    console.log(`开发模式\\n启动 webpack-dev-server`);\n    console.log(\"\\n\");\n    console.log(\n        \"webpack-react-vue-spa-awesome-config start --mode=development\"\n    );\n    console.log(\"\\n\");\n    console.log(`生产模式\\n启动 webpack`);\n    console.log(\"\\n\");\n    console.log(\"webpack-react-vue-spa-awesome-config build --mode=production\");\n    console.log(\"\\n\");\n    process.exit(1);\n}\n"],"names":["执行命令","command","commandargs","console","log","concat","_toConsumableArray","runobj","spawn","stdio","shell","stdout","on","data","split","filter","t","join","stderr","error","code","process","exit","pwddir","cwd","生成入口文件","sourcefiles","destfiles","forEach","p","i","fs","existsSync","map","path","resolve","e","mkdirSync","判断并创建目录","copyFileSync","commandfind","__dirname","trim","platform","inputfiles","webpackcmd","addparamstocmdargs","参数object","Object","entries","_ref","_ref2","_slicedToArray","key","value","push","changecmdnpx","setcmd","unshift","__filename","inargs","argv","slice","参数obj","operation","includes","undefined","s","startsWith","_wrapRegExp","exec","execArray","_a","_b","_c","groups","JSON","stringify","解析参数config","defaultwebpackconfig","require","参数webpackconfigfile","Reflect","set","mode","env","NODE_ENV","cmd","start"],"mappings":"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"}